<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>은행 검색</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=7cb81aac7a812102cdad6c057310ad9d&libraries=services"></script>
</head>
<body>
    <h1>근처 은행 검색</h1>
    <input id="location" type="text" placeholder="위치 (위도,경도)" value="126.97843,37.56668">
    <input id="keyword" type="text" placeholder="검색어 (은행 이름)" value="은행">
    <button onclick="searchBanks()">검색</button>
    <div id="map" style="width: 100%; height: 400px;"></div>

    <script>
        let map;
        let markers = [];

        // 지도 초기화
        function initMap() {
            const mapContainer = document.getElementById('map');
            const mapOption = {
                center: new kakao.maps.LatLng(37.56668, 126.97843), // 초기 중심 좌표 (서울)
                level: 3, // 지도 확대 레벨
            };
            map = new kakao.maps.Map(mapContainer, mapOption);
        }

        // 은행 검색
        async function searchBanks() {
            const locationInput = document.getElementById('location').value;
            const keywordInput = document.getElementById('keyword').value;

            const [lng, lat] = locationInput.split(',');

            const response = await fetch(`/api/core/search-banks/?location=${locationInput}&keyword=${keywordInput}`);
            const data = await response.json();

            if (data.documents) {
                addMarkers(data.documents);
            } else {
                alert("검색 결과가 없습니다.");
            }
        }

        // 지도에 마커 추가
        function addMarkers(banks) {
            // 이전 마커 삭제
            markers.forEach((marker) => marker.setMap(null));
            markers = [];

            banks.forEach((bank) => {
                const position = new kakao.maps.LatLng(bank.y, bank.x);

                const marker = new kakao.maps.Marker({
                    map: map,
                    position: position,
                });

                markers.push(marker);

                kakao.maps.event.addListener(marker, "click", () => {
                    alert(`${bank.place_name}\n주소: ${bank.road_address_name}`);
                });
            });
        }

        // 초기화
        window.onload = initMap;
    </script>
    
</body>
</html>
